import{e as ue,f as $e,g as ce,o as l,w as de,c as d,h as T,a as o,n as Ce,t as q,T as Ue,u as Le,i as Ae,j as Ee,k as Se,r as f,l as Pe,b as le,m as K,p as x,q as N,v as V,d as X,F as D,s as Be,x as re,_ as De,y as Ie}from"./CAjE_Kqs.js";import{_ as pe}from"./DlAUqK2U.js";import{u as Fe}from"./DbhZ8Dz_.js";const Me={key:0,class:"fixed left-1/2 -translate-x-1/2 bottom-5 z-50"},Ke=ue({__name:"UiToast",props:{visible:{type:Boolean},type:{},message:{}},setup(j){const R=j,b=$e(()=>R.type==="error"?"bg-rose-900/15 border-rose-700/40 text-rose-200":"bg-emerald-900/15 border-emerald-700/40 text-emerald-200");return(h,fe)=>(l(),ce(Ue,{name:"fade-up"},{default:de(()=>[h.visible?(l(),d("div",Me,[o("div",{class:Ce(["rounded-lg border px-3 py-2 text-sm shadow-lift",b.value]),role:"status","aria-live":"polite"},q(h.message),3)])):T("",!0)]),_:1}))}}),Ne=pe(Ke,[["__scopeId","data-v-1edb5080"]]),Ve={class:"container-page py-8"},qe={key:0,class:"panel-muted p-4 mt-4"},Re={class:"block"},He={class:"block"},We={key:0,class:"uploading inline-flex items-center gap-2 text-xs text-base-sub -mt-1"},ze={class:"mt-6"},Oe={key:0,class:"border border-rose-900/60 bg-rose-900/20 text-rose-300 rounded-md px-3 py-2 mb-3"},Xe={key:1,class:"text-base-sub"},je={key:2,class:"text-rose-400"},Ge={key:0,class:"panel p-6 text-center"},Je={key:1,class:"list-none p-0 grid gap-3"},Ye=["onClick","onPaste"],Qe=["onClick"],Ze=["href"],et=["onKeydown"],tt={key:0,class:"uploading inline-flex items-center gap-2 text-xs text-base-sub mt-2"},st={class:"m-0 mb-2 text-[21px] font-semibold leading-tight tracking-tight"},nt=["innerHTML"],ot={class:"text-[12px] text-base-sub mt-3 pt-2 border-t border-base-border/60"},at=ue({__name:"index",setup(j){Le();const R=Ae(),b=Ee(),h=Fe(),G=(Se().public?.apiBase||"").replace(/\/$/,""),w=f([]),H=f(!1),k=f(""),$=f(""),p=f(""),y=f(null),A=f(""),m=f("");let J=null;const C=f(!1),W=f(!1),Y=f(""),Q=f("success");let Z="",ee=0,E=null;function te(){typeof window>"u"||(E&&E.disconnect(),E=new IntersectionObserver(t=>{for(const e of t)e.isIntersecting&&(e.target.classList.add("in"),E?.unobserve(e.target))},{root:null,rootMargin:"0px 0px -10% 0px",threshold:.15}),document.querySelectorAll("li.reveal").forEach(t=>E.observe(t)))}function me(t){try{const e=new Date(t);return isNaN(e.getTime())?t:new Intl.DateTimeFormat(void 0,{year:"numeric",month:"short",day:"2-digit",hour:"2-digit",minute:"2-digit"}).format(e)}catch{return t}}async function ge(){H.value=!0,k.value="";try{w.value=await h.get("/posts")}catch(t){k.value=t?.message||"Failed to load posts"}finally{H.value=!1}await re(),te()}function _(t,e="success"){Y.value=t,Q.value=e,W.value=!0,window.clearTimeout(_._t),_._t=window.setTimeout(()=>W.value=!1,1600)}function se(t){return(t||"").toLowerCase().trim().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-")}async function ne(){try{const t={title:$.value,content:p.value,slug:se($.value),status:"draft"},e=await h.post("/posts",t);w.value.unshift(e),$.value="",p.value="",await re(),te()}catch(t){k.value=t?.message||"Failed to create post"}}async function ve(t){try{await h.del(`/posts/${t}`),w.value=w.value.filter(e=>e.id!==t),_("Deleted","success")}catch(e){k.value=e?.message||"Failed to delete post",_("Delete failed","error")}}function ye(t){b.editing&&y.value!==t.id&&(y.value=t.id,A.value=t.title,m.value=t.content)}function xe(t,e){b.editing&&y.value!==t.id&&ye(t)}async function z(){if(y.value)try{const t=y.value,e={title:A.value,content:m.value,slug:se(A.value),status:"draft"},i=await h.put(`/posts/${t}`,e),a=w.value.findIndex(n=>n.id===t);a!==-1&&(w.value[a]=i),_("Saved","success")}catch(t){k.value=t?.message||"Failed to save post",_("Save failed","error")}finally{y.value=null}}function oe(){clearTimeout(J),J=setTimeout(()=>{const t=document.activeElement,e=t?.classList?.contains("title-input"),i=t?.classList?.contains("content-input");!e&&!i&&z()},120)}function be(t){return t.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;")}function he(t){return t?be(t).replace(/!\[[^\]]*\]\(\s*([^\)\s]+)(?:\s+\"[^\"]*\")?\s*\)/g,(n,r)=>{let s=String(r).trim();return s=s.replace(/^<|>$/g,""),s=s.replace(/^"+|"+$/g,""),s=s.replace(/[)]+$/g,""),s.startsWith("/uploads/")&&(s=`${G}${s}`),`<img src="${s}" alt="" />
`}).replace(/\[([^\]]+)\]\(\s*([^\)\s]+)(?:\s+\"[^\"]*\")?\s*\)/g,(n,r,s)=>{let u=String(s).trim();u=u.replace(/^<|>$/g,""),u=u.replace(/^"+|"+$/g,""),u=u.replace(/[)]+$/g,"");const P=String(r).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");return`<a href="${u}" target="_blank" rel="noopener noreferrer">${P}</a>`}):""}function we(t){const e=t?.slug||t?.id;return e?typeof window<"u"?`${location.origin}/p/${e}`:`/p/${e}`:""}function ke(t){const e=encodeURIComponent(t.title||""),i=encodeURIComponent(we(t));return`https://x.com/intent/tweet?text=${e}&url=${i}`}function _e(t){const e=t.currentTarget;if(!e)return;const i=e.getBoundingClientRect(),a=i.left+i.width/2,n=i.top+i.height/2,r=(t.clientX-a)/i.width,s=(t.clientY-n)/i.height,u=10;e.style.setProperty("--px",`${r*u}px`),e.style.setProperty("--py",`${s*u}px`)}function Te(t){const e=t.currentTarget;e&&(e.style.setProperty("--px","0px"),e.style.setProperty("--py","0px"))}async function ae(t){if(!b.editing||C.value)return;const e=t.clipboardData?.items,i=t.clipboardData?.files;let a=null;if(e&&e.length>0&&(a=Array.from(e).find(v=>v.kind==="file"||v.type.startsWith("image/"))?.getAsFile()||null),!a&&i&&i.length>0&&(a=Array.from(i).find(v=>v.type.startsWith("image/"))||null),!a)try{if(typeof navigator<"u"&&"clipboard"in navigator&&"read"in navigator.clipboard){const g=await navigator.clipboard.read();for(const v of g){const U=(v.types||[]).find(c=>c.startsWith("image/"));if(U){const c=await v.getType(U);a=new File([c],"clipboard-image",{type:c.type||U});break}}}}catch{}if(!a)return;const n=a.type&&a.type.startsWith("image/"),r=await a.slice(0,12).arrayBuffer().then(g=>new Uint8Array(g)).catch(()=>new Uint8Array),s=Array.from(r.slice(0,12)),u=s.length>=8&&s[0]===137&&s[1]===80&&s[2]===78&&s[3]===71,S=s.length>=3&&s[0]===255&&s[1]===216&&s[2]===255,P=s.length>=3&&s[0]===71&&s[1]===73&&s[2]===70,F=s.length>=12&&s[0]===82&&s[1]===73&&s[2]===70&&s[3]===70&&s[8]===87&&s[9]===69&&s[10]===66&&s[11]===80,M=s.length>=2&&s[0]===66&&s[1]===77;if(!(n||(u||S||P||F||M))){_("Pasted content is not an image","error");return}t.preventDefault();try{C.value=!0;const{url:g}=await h.upload("/api/upload","image",a),v=g.startsWith("/uploads/")?`${G}${g}`:g,U=Date.now();if(v===Z&&U-ee<1200){C.value=!1;return}Z=v,ee=U;const c=document.activeElement,L=`
![image](${v})
`;if(c&&c.classList.contains("content-input")){const B=c.selectionStart??m.value.length,O=c.selectionEnd??m.value.length;m.value=m.value.slice(0,B)+L+m.value.slice(O),requestAnimationFrame(()=>{c.selectionStart=c.selectionEnd=B+L.length})}else if(c&&c.classList.contains("new-content-input")){const B=c.selectionStart??p.value.length,O=c.selectionEnd??p.value.length;p.value=p.value.slice(0,B)+L+p.value.slice(O),requestAnimationFrame(()=>{c.selectionStart=c.selectionEnd=B+L.length})}else y.value?m.value+=L:p.value+=L}catch(g){k.value=g?.message||"Upload failed",_("Upload failed","error")}finally{C.value=!1}}function I(t){const e=t.target;if(e instanceof HTMLTextAreaElement&&(t.key==="k"||t.key==="K")&&(t.metaKey||t.ctrlKey)){t.preventDefault();const a=e,n=a.classList.contains("content-input"),r=a.classList.contains("new-content-input");if(!n&&!r)return;const s=n?m:p,u=a.selectionStart??0,S=a.selectionEnd??u,P=s.value.slice(u,S)||"link text",F=window.prompt("Enter URL to link to:","https://")||"";if(!F)return;const M=`[${P}](${F})`;s.value=s.value.slice(0,u)+M+s.value.slice(S),requestAnimationFrame(()=>{const ie=u+M.length;a.selectionStart=a.selectionEnd=ie,a.focus()});return}t.key==="Escape"&&(t.preventDefault(),y.value?z():b.editing&&($.value.trim()||p.value.trim())&&ne())}return Pe(()=>{ge()}),(t,e)=>{const i=De,a=Ne;return l(),d(D,null,[o("main",Ve,[e[20]||(e[20]=o("h2",{class:"text-xl font-semibold tracking-tight text-base-text mb-4"},"Posts",-1)),K(b).editing?(l(),d("section",qe,[e[15]||(e[15]=o("h3",{class:"text-base font-medium mb-3"},"New Post",-1)),o("form",{onSubmit:e[3]||(e[3]=x(n=>ne(),["prevent"])),class:"grid gap-3"},[o("label",Re,[e[11]||(e[11]=o("span",{class:"block text-xs text-base-sub mb-1"},"Title",-1)),N(o("input",{class:"input new-title-input","onUpdate:modelValue":e[0]||(e[0]=n=>$.value=n),placeholder:"Title",required:"",onKeydown:I},null,544),[[V,$.value]])]),o("label",He,[e[12]||(e[12]=o("span",{class:"block text-xs text-base-sub mb-1"},"Content",-1)),N(o("textarea",{class:"input new-content-input","onUpdate:modelValue":e[1]||(e[1]=n=>p.value=n),placeholder:"Content",rows:"6",onKeydown:I,onPaste:e[2]||(e[2]=x(n=>ae(n),["stop"]))},null,544),[[V,p.value]])]),C.value?(l(),d("div",We,[...e[13]||(e[13]=[o("span",{class:"spinner"},null,-1),X(" Uploading image… ",-1)])])):T("",!0),e[14]||(e[14]=o("div",{class:"flex justify-end"},[o("button",{class:"btn-primary focus-ring",type:"submit"},"Create")],-1))],32)])):T("",!0),o("section",ze,[K(R).query.missing==="1"?(l(),d("div",Oe," The post you tried to edit was not found. ")):T("",!0),H.value?(l(),d("div",Xe,"Loading...")):k.value?(l(),d("div",je,q(k.value),1)):(l(),d(D,{key:3},[w.value.length===0?(l(),d("div",Ge,[...e[16]||(e[16]=[o("div",{class:"text-base-sub mb-2"},"No posts yet",-1),o("div",{class:"text-sm text-zinc-400"},"Use edit mode to create your first post. Paste an image to attach quickly.",-1)])])):(l(),d("ul",Je,[(l(!0),d(D,null,Be(w.value,n=>(l(),d("li",{key:n.id,class:"panel card card-art reveal p-4 cursor-default hover-lift hover-ring focus-ring",tabindex:"0",onClick:r=>xe(n),onPaste:x(r=>y.value===n.id?ae(r):null,["stop"]),onMousemove:_e,onMouseleave:Te},[K(b).editing?T("",!0):(l(),ce(i,{key:0,to:`/p/${n.slug||n.id}`,class:"card-link-overlay","aria-hidden":"true",tabindex:"-1",onClick:e[4]||(e[4]=x(()=>{},["stop"]))},null,8,["to"])),e[19]||(e[19]=o("div",{class:"timeline","aria-hidden":"true"},null,-1)),K(b).editing?(l(),d("button",{key:1,class:"card-close focus-ring",onClick:x(r=>ve(n.id),["stop"]),"aria-label":"Delete post",title:"Delete"},"×",8,Qe)):T("",!0),o("a",{class:"card-xshare focus-ring",href:ke(n),target:"_blank",rel:"noopener noreferrer","aria-label":"Share on X",title:"Share on X",onClick:e[5]||(e[5]=x(()=>{},["stop"]))},[...e[17]||(e[17]=[o("svg",{viewBox:"0 0 24 24",width:"16",height:"16",fill:"currentColor","aria-hidden":"true"},[o("path",{d:"M18.244 2.25h3.308l-7.227 8.26 8.49 11.24H16.27l-5.38-7.04-6.15 7.04H1.43l7.73-8.84L1 2.25h7.03l4.86 6.5 5.354-6.5zm-1.16 18.24h1.832L7.01 4.13H5.06l12.025 16.36z"})],-1)])],8,Ze),y.value===n.id?(l(),d(D,{key:2},[N(o("input",{"onUpdate:modelValue":e[6]||(e[6]=r=>A.value=r),class:"title-input input !text-base !font-medium !mb-2",placeholder:"Title",onBlur:oe,onKeydown:[Ie(x(z,["prevent"]),["enter"]),I],onClick:e[7]||(e[7]=x(()=>{},["stop"])),autofocus:""},null,40,et),[[V,A.value]]),N(o("textarea",{"onUpdate:modelValue":e[8]||(e[8]=r=>m.value=r),class:"content-input input !min-h-[180px]",rows:"6",placeholder:"Content",onBlur:oe,onKeydown:I,onClick:e[9]||(e[9]=x(()=>{},["stop"]))},null,544),[[V,m.value]]),C.value?(l(),d("div",tt,[...e[18]||(e[18]=[o("span",{class:"spinner"},null,-1),X(" Uploading image… ",-1)])])):T("",!0)],64)):(l(),d(D,{key:3},[o("h4",st,[le(i,{to:`/p/${n.slug||n.id}`,class:"no-underline text-base-text hover:text-indigo-300 focus-ring",onClick:e[10]||(e[10]=x(()=>{},["stop"]))},{default:de(()=>[X(q(n.title),1)]),_:2},1032,["to"])]),o("div",{class:"prose-content prose-a:text-indigo-400 hover:prose-a:text-indigo-300 prose-img:rounded-xl prose-img:shadow-subtle",innerHTML:he(n.content)},null,8,nt)],64)),o("div",ot,"Updated: "+q(me(n.updatedAt||n.createdAt)),1)],40,Ye))),128))]))],64))])]),le(a,{visible:W.value,type:Q.value,message:Y.value},null,8,["visible","type","message"])],64)}}}),ut=pe(at,[["__scopeId","data-v-bb526135"]]);export{ut as default};
