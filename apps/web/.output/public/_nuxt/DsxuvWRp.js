import{e as B,k as H,r as m,l as I,c as p,b as N,a as l,w as U,t as f,i as z,u as D,_ as R,o as d,d as M}from"./CAjE_Kqs.js";import{u as F}from"./D7gjyddL.js";import{u as P}from"./DbhZ8Dz_.js";import{_ as V}from"./DlAUqK2U.js";const W={class:"container-page py-8"},X={class:"mt-4"},E={key:0,class:"text-base-sub"},K={key:1,class:"text-rose-400"},O={key:2,class:"panel p-6 text-center"},j={key:3,class:"panel card card-art reveal in p-4 relative"},q=["href"],G={class:"m-0 mb-2 text-[21px] font-semibold leading-tight tracking-tight"},J=["innerHTML"],Q={class:"text-[12px] text-base-sub mt-3 pt-2 border-t border-base-border/60"},Y=B({__name:"[slug]",setup(Z){const $=z(),y=D(),w=P(),h=(H().public?.apiBase||"").replace(/\/$/,""),g=m(!1),u=m(""),r=m(null);function b(e){try{const t=new Date(e);return isNaN(t.getTime())?e:new Intl.DateTimeFormat(void 0,{year:"numeric",month:"short",day:"2-digit",hour:"2-digit",minute:"2-digit"}).format(t)}catch{return e}}function k(e){return e.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;")}function S(e){return e?k(e).replace(/!\[[^\]]*\]\(\s*([^\)\s]+)(?:\s+\"[^\"]*\")?\s*\)/g,(i,c)=>{let a=String(c).trim();return a=a.replace(/^<|>$/g,""),a=a.replace(/^"+|"+$/g,""),a=a.replace(/[)]+$/g,""),a.startsWith("/uploads/")&&(a=`${h}${a}`),`<img src="${a}" alt="" />
`}).replace(/\[([^\]]+)\]\(\s*([^\)\s]+)(?:\s+\"[^\"]*\")?\s*\)/g,(i,c,a)=>{let o=String(a).trim();o=o.replace(/^<|>$/g,""),o=o.replace(/^"+|"+$/g,""),o=o.replace(/[)]+$/g,"");const T=String(c).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");return`<a href="${o}" target="_blank" rel="noopener noreferrer">${T}</a>`}):""}function _(e){return String(e||"").normalize("NFKD").replace(/[\u0300-\u036f]/g,"").toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"")}function v(e){return _(e?.title||"")||e?.slug||e?.id||""}function x(e){const t=v(e);return t?typeof window<"u"?`${location.origin}/p/${t}`:`/p/${t}`:""}function L(e){const t=encodeURIComponent(e?.title||""),n=encodeURIComponent(x(e));return`https://x.com/intent/tweet?text=${t}&url=${n}`}async function A(){g.value=!0,u.value="";try{const e=$.params.slug,t=await w.get("/posts"),n=s=>{const i=_(s?.title||"");return s?.id===e||s?.slug===e||!!i&&i===e};if(r.value=Array.isArray(t)&&t.find(n)||null,r.value||(u.value="Post not found"),r.value){const s=v(r.value);s&&s!==e&&y.replace({path:`/p/${s}`});const i=C(r.value?.content||""),c=x(r.value),a=extractDescription(r.value?.content||""),o=[{property:"og:title",content:r.value.title||""},{property:"og:type",content:"article"},{property:"og:url",content:c},{property:"og:description",content:a},{name:"twitter:title",content:r.value.title||""},{name:"twitter:description",content:a}];i?(o.push({name:"twitter:card",content:"summary_large_image"}),o.push({property:"og:image",content:i}),o.push({name:"twitter:image",content:i})):o.push({name:"twitter:card",content:"summary"}),F({title:r.value.title||"Post",link:[{rel:"canonical",href:c}],meta:o})}}catch(e){u.value=e?.message||"Failed to load post"}finally{g.value=!1}}function C(e){if(!e)return"";const t=e.match(/!\[[^\]]*\]\(\s*([^\)\s]+)(?:\s+\"[^\"]*\")?\s*\)/);if(!t)return"";let n=String(t[1]||"").trim();return n=n.replace(/^<|>$/g,""),n=n.replace(/^"+|"+$/g,""),n=n.replace(/[)]+$/g,""),n?n.startsWith("/uploads/")?`${h}${n}`:n:""}return I(()=>{A()}),(e,t)=>{const n=R;return d(),p("main",W,[N(n,{to:"/",class:"text-sm text-zinc-400 hover:text-zinc-200"},{default:U(()=>[...t[0]||(t[0]=[M("‚Üê Back",-1)])]),_:1}),l("section",X,[g.value?(d(),p("div",E,"Loading...")):u.value?(d(),p("div",K,f(u.value),1)):r.value?(d(),p("div",j,[l("a",{class:"card-xshare focus-ring",href:L(r.value),target:"_blank",rel:"noopener noreferrer","aria-label":"Share on X",title:"Share on X"},[...t[1]||(t[1]=[l("svg",{viewBox:"0 0 24 24",width:"16",height:"16",fill:"currentColor","aria-hidden":"true"},[l("path",{d:"M18.244 2.25h3.308l-7.227 8.26 8.49 11.24H16.27l-5.38-7.04-6.15 7.04H1.43l7.73-8.84L1 2.25h7.03l4.86 6.5 5.354-6.5zm-1.16 18.24h1.832L7.01 4.13H5.06l12.025 16.36z"})],-1)])],8,q),l("h4",G,f(r.value.title),1),l("div",{class:"prose-content prose-a:text-indigo-400 hover:prose-a:text-indigo-300 prose-img:rounded-xl prose-img:shadow-subtle",innerHTML:S(r.value.content)},null,8,J),l("div",Q,"Updated: "+f(b(r.value.updatedAt||r.value.createdAt)),1)])):(d(),p("div",O,"Post not found."))])])}}}),se=V(Y,[["__scopeId","data-v-612c9da0"]]);export{se as default};
