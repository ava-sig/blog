import{e as w,j as C,i as _,r as p,l as E,u as S,E as B,c as l,a,h as V,m as q,t as F,p as M,q as g,v as m,o as u}from"./CAjE_Kqs.js";import{u as $}from"./DbhZ8Dz_.js";const A={style:{padding:"16px","max-width":"800px",margin:"0 auto"}},D={key:0,style:{color:"#b00"}},L={key:1},N={key:2,style:{color:"#b00"}},j=w({__name:"[id]",setup(R){const y=_(),s=S(),v=$(),o=C(),f=String(y.params.id||""),n=p(""),r=p(""),c=p(!1),i=p("");async function h(){c.value=!0,i.value="";try{const t=await v.get(`/posts/${f}`);n.value=t.title,r.value=t.content}catch(t){const e=t?.message||"Failed to load post";if(i.value=e,/not\s*found/i.test(e)){s.replace({path:"/",query:{missing:"1"}});return}}finally{c.value=!1}}function x(t){return(t||"").toLowerCase().trim().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-")}async function b(){try{await v.put(`/posts/${f}`,{title:n.value,content:r.value,slug:x(n.value),status:"draft"}),s.push("/")}catch(t){i.value=t?.message||"Failed to save post"}}function k(){s.push("/")}return E(()=>{if(!o.editing&&(o.loadFromStorage(),!o.editing)){s.replace("/");return}h()}),B(()=>{o.editing||s.replace("/")}),(t,e)=>(u(),l("main",A,[e[4]||(e[4]=a("h2",null,"Edit Post",-1)),q(o).editing?V("",!0):(u(),l("div",D,"Editing is disabled")),c.value?(u(),l("div",L,"Loading...")):i.value?(u(),l("div",N,F(i.value),1)):(u(),l("form",{key:3,onSubmit:e[2]||(e[2]=M(d=>b(),["prevent"])),style:{display:"grid",gap:"8px"}},[g(a("input",{"onUpdate:modelValue":e[0]||(e[0]=d=>n.value=d),placeholder:"Title",required:""},null,512),[[m,n.value]]),g(a("textarea",{"onUpdate:modelValue":e[1]||(e[1]=d=>r.value=d),placeholder:"Content",rows:"10"},null,512),[[m,r.value]]),a("div",{style:{display:"flex",gap:"8px"}},[e[3]||(e[3]=a("button",{type:"submit"},"Save",-1)),a("button",{type:"button",onClick:k},"Cancel")])],32))]))}});export{j as default};
